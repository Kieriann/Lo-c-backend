generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Address {
  id         Int     @id @default(autoincrement())
  address    String
  city       String
  state      String
  country    String
  postalCode String
  profileId  Int     @unique
  lat        Float?
  lng        Float?
  Profile    Profile @relation(fields: [profileId], references: [id])
}

model User {
  id                     Int                 @id @default(autoincrement())
  email                  String              @unique @db.VarChar(255)
  username               String
  password               String
  isAdmin                Boolean             @default(false)
  updatedAt              DateTime            @updatedAt
  createdAt              DateTime            @default(now())
  emailConfirmed         Boolean             @default(false)
  emailConfirmationToken String?             @unique
  firstLoginAt           DateTime?
  sponsorEmail           String?             @db.VarChar(255)
  role                   Role                @default(INDEP)
  Applications           Application[]
  clientProfile          ClientProfile?
  clientRequests         ClientRequest[]
  CustomersReferences    CustomerReference[]
  Diplomas               Diploma[]
  Experiences            Experience[]
  receivedMessages       Message[]           @relation("ReceivedMessages")
  sentMessages           Message[]           @relation("SentMessages")
  Prestations            Prestation[]
  Profile                Profile?
  realisations           Realisation[]
  serviceRequestsOwned   ServiceRequest[]    @relation("UserServiceRequests")
  shortlistsAsCandidate  ServiceShortlist[]  @relation("UserShortlistCandidate")
  suggestions            Suggestion[]
  Trainings              Training[]
  Documents              Document[]
}

model Document {
  id           Int     @id @default(autoincrement())
  userId       Int
  type         String
  fileName     String
  originalName String
  format       String?
  version      Int?
  publicId     String?
  User         User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("documents")
}

model Profile {
  id                 Int           @id @default(autoincrement())
  firstname          String?       @default("")
  lastname           String?       @default("")
  phone              String?       @default("")
  bio                String?       @default("")
  languages          Json?         @default("[]")
  siret              String?       @default("")
  registrationNumber String?       @default("")
  smallDayRate       Int?          @default(0)
  mediumDayRate      Int?          @default(0)
  highDayRate        Int?          @default(0)
  teleworkDays       Int           @default(0)
  isEmployed         Boolean?      @default(false)
  availableDate      DateTime?
  userId             Int           @unique
  website            String?
  workerStatus       WorkerStatus  @default(indep)
  memberStatus       MemberStatus?
  Address            Address?
  User               User          @relation(fields: [userId], references: [id])
}

model Message {
  id         Int      @id @default(autoincrement())
  senderId   Int
  receiverId Int
  content    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
}

model CustomerReference {
  id         Int      @id @default(autoincrement())
  name       String
  email      String
  phone      String
  mark       Int
  commentary String
  userId     Int
  updatedAt  DateTime @updatedAt
  createdAt  DateTime @default(now())
  User       User     @relation(fields: [userId], references: [id])
}

model Experience {
  id          Int      @id @default(autoincrement())
  title       String
  client      String
  description String
  domains     String
  languages   String[]
  skills      String
  userId      Int
  User        User     @relation(fields: [userId], references: [id])
  domainsList Domain[] @relation("DomainToExperience")
}

model Realisation {
  id          Int               @id @default(autoincrement())
  title       String
  description String
  userId      Int
  user        User              @relation(fields: [userId], references: [id])
  files       RealisationFile[] @relation("RealisationFiles")
  technos     Techno[]          @relation("RealisationTechnos")
}

model RealisationFile {
  id            Int         @id @default(autoincrement())
  realisationId Int
  fileName      String
  originalName  String
  version       Int?
  publicId      String
  format        String
  realisation   Realisation @relation("RealisationFiles", fields: [realisationId], references: [id], onDelete: Cascade)
}

model Techno {
  id            Int         @id @default(autoincrement())
  name          String
  level         String
  realisationId Int
  realisation   Realisation @relation("RealisationTechnos", fields: [realisationId], references: [id], onDelete: Cascade)
}

model Training {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  skills      Json
  userId      Int
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
  User        User     @relation(fields: [userId], references: [id])
  Domains     Domain[] @relation("DomainToTraining")
}

model Diploma {
  id        Int         @id @default(autoincrement())
  title     String
  type      DiplomaType
  skills    Json
  languages Json
  userId    Int
  domainId  Int
  updatedAt DateTime    @updatedAt
  createdAt DateTime    @default(now())
  Domain    Domain      @relation(fields: [domainId], references: [id])
  User      User        @relation(fields: [userId], references: [id])
}

model Application {
  id             Int      @id @default(autoincrement())
  title          String
  description    String
  software       String
  whitePaperPath String
  whitePaperUrl  String
  domainId       Int
  userId         Int
  updatedAt      DateTime @updatedAt
  createdAt      DateTime @default(now())
  Domain         Domain   @relation(fields: [domainId], references: [id])
  User           User     @relation(fields: [userId], references: [id])
}

model Prestation {
  id     Int    @id @default(autoincrement())
  type   String
  tech   String
  level  String
  userId Int
  user   User   @relation(fields: [userId], references: [id])
}

model Domain {
  id          Int           @id @default(autoincrement())
  name        String        @unique
  Application Application[]
  Diploma     Diploma[]
  experiences Experience[]  @relation("DomainToExperience")
  Training    Training[]    @relation("DomainToTraining")
}

model ServiceRequest {
  id          Int                  @id @default(autoincrement())
  ownerId     Int
  title       String               @default("")
  description String
  minRate     Int
  maxRate     Int
  deadline    DateTime?
  status      ServiceRequestStatus @default(DRAFT)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  owner       User                 @relation("UserServiceRequests", fields: [ownerId], references: [id], onDelete: Cascade)
  items       ServiceRequestItem[]
  shortlist   ServiceShortlist[]
}

model ServiceRequestItem {
  id               Int            @id @default(autoincrement())
  serviceRequestId Int
  skillLabel       String
  level            String
  serviceRequest   ServiceRequest @relation(fields: [serviceRequestId], references: [id], onDelete: Cascade)
}

model ServiceShortlist {
  id               Int             @id @default(autoincrement())
  serviceRequestId Int
  candidateId      Int
  status           ShortlistStatus @default(PENDING)
  createdAt        DateTime        @default(now())
  candidate        User            @relation("UserShortlistCandidate", fields: [candidateId], references: [id], onDelete: Cascade)
  serviceRequest   ServiceRequest  @relation(fields: [serviceRequestId], references: [id], onDelete: Cascade)

  @@unique([serviceRequestId, candidateId])
}

model City {
  id             Int             @id @default(autoincrement())
  name           String
  country        String
  countryCode    String
  createdAt      DateTime        @default(now())
  lat            Float?
  lng            Float?
  clientRequests ClientRequest[]

  @@index([name])
}

model ClientRequest {
  id              Int                       @id @default(autoincrement())
  kind            RequestKind
  locationMode    LocationMode              @default(REMOTE)
  cityId          Int?
  citySnapshot    String?
  userId          Int
  createdAt       DateTime                  @default(now())
  locationWeight  Int?                      @default(0)
  remoteDaysCount Int?                      @default(0)
  tjmMax          Int?
  tjmMin          Int?
  tjmWeight       Int?                      @default(0)
  city            City?                     @relation(fields: [cityId], references: [id])
  client          User                      @relation(fields: [userId], references: [id])
  technologies    ClientRequestTechnology[]
}

model ClientProfile {
  id                Int      @id @default(autoincrement())
  userId            Int      @unique
  companyName       String?
  siret             String?
  sector            String?
  contactFirstName  String?
  contactLastName   String?
  contactRole       String?
  email             String?
  phone             String?
  addressStreet     String?
  addressPostalCode String?
  addressCity       String?
  addressCountry    String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  clientType        String?
  user              User     @relation(fields: [userId], references: [id])
}

model Suggestion {
  id        Int              @id @default(autoincrement())
  userId    Int
  title     String           @db.VarChar(150)
  content   String
  status    SuggestionStatus @default(PENDING)
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ClientRequestTechnology {
  id         Int           @id @default(autoincrement())
  requestId  Int
  technology String
  level      Level         @default(JUNIOR)
  weight     Int           @default(0)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  request    ClientRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
}

enum ServiceRequestStatus {
  DRAFT
  OPEN
  CLOSED
}

enum ShortlistStatus {
  PENDING
  CONTACTED
  REJECTED
}

enum MemberStatus {
  vip
  membre
  abonne
}

enum WorkerStatus {
  indep
  salarie
}

enum DocumentType {
  ID_PHOTO
  CV
}

enum DiplomaType {
  DIPLOMA
  CERTIFICATE
}

enum Role {
  INDEP
  CLIENT
  ADMIN
}

enum RequestKind {
  EXPERTISE
  MISSION
  PREEMBAUCHE
}

enum Level {
  JUNIOR
  MEDIUM
  EXPERT
}

enum LocationMode {
  REMOTE
  ONSITE
}

enum SuggestionStatus {
  PENDING
  IN_REVIEW
  DONE
}

model Forum {
  id        Int      @id @default(autoincrement())
  title     String
  group     String   @default("general") 
  createdAt DateTime @default(now())
}